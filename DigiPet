#!/usr/bin/env python

import os
import random
import time
from blessed import Terminal
from pet_initialization import initialize_pet

# Define the pet's ASCII art representation
pet_ascii = r"""
   /\_/\
 ( o.o )
 > ^ <
"""

# Initialize the terminal
term = Terminal()

# Define the dimensions of the pet's square box and menu
box_width = 40
box_height = 10
menu_height = 5

# Initial position of the pet
pet_x = box_width // 2
pet_y = box_height // 2

# Function to clear the terminal screen
def clear_screen():
    print(term.clear)

# Function to move the pet
def move_pet():
    global pet_x, pet_y

    # Generate random movements within a larger range
    dx = random.randint(-2, 2)
    dy = random.randint(-2, 2)

    # Update the pet's position
    pet_x += dx
    pet_y += dy

    # Keep the pet within the boundaries of the box
    pet_x = max(2, min(pet_x, box_width - len(pet_ascii.split('\n')[0]) - 2))
    pet_y = max(2, min(pet_y, box_height - pet_ascii.count('\n') - 2))

# Function to display the pet and menu
def display_pet_and_menu():
    with term.location(0, 0):
        # Draw the box
        print(term.white('─' * box_width))
        for _ in range(box_height - 2):
            print(term.white('│' + ' ' * (box_width - 2) + '│'))
        print(term.white('─' * box_width))

        # Print the pet
        lines = pet_ascii.strip().split('\n')
        for i, line in enumerate(lines):
            print(term.move_xy(pet_x, pet_y + i) + line)

        # Print the menu options
        menu_text = "Menu: 1. Info  |  2. Feed  |  3. Play  |  4. Exit"
        print(term.move_xy(0, box_height) + term.black_on_white(menu_text))

# Main function
def main():
    # Check if the data file exists
    data_file = os.path.expanduser("~/.Digipet/data.txt")
    if not os.path.exists(data_file):
        initialize_pet()

    with term.fullscreen(), term.hidden_cursor():
        while True:
            clear_screen()
            display_pet_and_menu()
            move_pet()
            time.sleep(0.5)  # Adjust the delay as desired for the pet's movement speed

# Execute the main function
if __name__ == "__main__":
    main()
